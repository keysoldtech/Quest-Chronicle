<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest & Chronicle - Multiplayer Prototype</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=MedievalSharp&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/style.css">
</head>
<body>

    <!-- Lobby Screen: Visible on page load -->
    <div id="lobby" class="lobby-container">
        <h1 class="title-font">Quest & Chronicle</h1>
        <p class="subtitle-font">Multiplayer Prototype 3.65</p>
        
        <div class="input-group">
            <label for="playerName">Player Name</label>
            <input type="text" id="playerName" class="input-field" placeholder="e.g., Elara the Brave">
        </div>
        
        <div id="game-mode-selector" class="input-group">
            <label>Game Mode</label>
            <div class="radio-group">
                <label class="radio-label">
                    <input type="radio" name="gameMode" value="Beginner" class="sr-only" checked>
                    <span>Beginner</span>
                </label>
                <label class="radio-label">
                    <input type="radio" name="gameMode" value="Advanced" class="sr-only">
                    <span>Advanced</span>
                </label>
            </div>
        </div>

        <div class="button-group">
            <button id="createRoomBtn" class="btn btn-primary">Create New Room</button>
            <div class="join-group">
                <input type="text" id="roomIdInput" class="input-field" placeholder="Enter Room Code">
                <button id="joinRoomBtn" class="btn btn-secondary">Join Room</button>
            </div>
        </div>
    </div>

    <!-- Game Area: Hidden until a room is joined -->
    <div id="game-area" class="game-area hidden">
        <header class="game-header">
            <div class="header-info">
                 <p id="turn-indicator" class="turn-indicator-font">Waiting for game to start...</p>
                 <p class="turn-counter">Turn: <span id="turn-counter">0</span></p>
                 <p class="build-number-font">v3.65</p>
            </div>
             <div class="header-controls">
                <div id="dm-controls" class="dm-controls hidden">
                     <button id="dm-play-monster-btn" class="btn btn-sm btn-secondary">Play Monster</button>
                </div>
                <button id="chat-toggle-btn" class="btn btn-sm btn-secondary">Chat</button>
                <button id="join-voice-btn" class="btn btn-sm btn-success">Join Voice</button>
                <button id="leave-game-btn" class="btn btn-sm btn-danger hidden">Leave Game</button>
                <button id="startGameBtn" class="btn btn-primary hidden">Start Game</button>
                <div class="room-code-display">
                    <p>Room Code:</p>
                    <p id="room-code">----</p>
                </div>
            </div>
        </header>

        <main class="game-main">
            <!-- Left Column: Player List, Class Selection, Stats -->
            <aside class="left-panel">
                <div class="panel">
                    <h2 class="panel-header">Players</h2>
                    <ul id="player-list" class="player-list"></ul>
                </div>

                <div id="class-selection" class="panel hidden">
                    <h2 class="panel-header">Choose Your Class</h2>
                    <div id="class-cards-container" class="class-cards-container">
                        <!-- Class cards will be generated here -->
                    </div>
                    <div class="class-confirm-container">
                         <button id="confirm-class-btn" class="btn btn-primary hidden">Confirm Class</button>
                    </div>
                </div>
                
                <div id="advanced-card-choice" class="panel hidden">
                    <h2 class="panel-header">Choose Starting Card</h2>
                    <div id="advanced-choice-buttons" class="button-grid">
                        <!-- Advanced choice buttons will be generated here -->
                    </div>
                </div>

                <div id="player-stats-container" class="panel hidden">
                     <h2 class="panel-header">Your Stats</h2>
                     <div id="player-stats" class="player-stats">
                         <!-- Stats will be rendered here -->
                     </div>
                </div>
            </aside>

            <!-- Right Column: Game Board & Player Hand -->
            <div class="right-panel">
                <div class="upper-board-area">
                    <div class="world-events-section panel">
                         <h2 class="panel-header">World Events</h2>
                         <div id="world-events-container" class="card-container-row"></div>
                    </div>
                    <div class="party-loot-section panel">
                        <h2 class="panel-header">Party Discoveries</h2>
                        <div id="party-loot-container" class="card-container-row">
                            <!-- Loot cards will be rendered here -->
                        </div>
                    </div>
                    <div id="game-board" class="game-board-section panel">
                        <h2 class="panel-header">Game Board</h2>
                        <div id="board-cards" class="card-container-row"></div>
                    </div>
                </div>
                <div class="player-hand-section panel">
                    <div class="player-hand-header">
                        <h2 class="panel-header">Your Hand & Equipment</h2>
                        <div class="player-turn-controls">
                            <div id="player-actions-container" class="player-actions-container hidden">
                                <!-- Rest buttons will be added here by client.js -->
                            </div>
                            <button id="confirm-attack-btn" class="btn btn-primary hidden">Confirm Attack</button>
                            <button id="endTurnBtn" class="btn btn-primary hidden">End Turn</button>
                        </div>
                    </div>
                    
                    <div id="equipped-items-container" class="equipped-items-container">
                        <h3 class="sub-header-font">Equipped</h3>
                        <div id="equipped-items" class="card-container-row">
                            <!-- Equipped items will be rendered here -->
                        </div>
                    </div>
                    <div id="player-hand" class="player-hand-container card-container-row"></div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Chat Overlay -->
    <div id="chat-overlay" class="chat-overlay hidden">
        <div class="chat-header">
            <h2 class="panel-header">Chat & Log</h2>
            <button id="chat-close-btn" class="chat-close-btn">&times;</button>
        </div>
        <div id="chat-log" class="chat-log"></div>
        <form id="chat-form" class="chat-form">
            <select id="chat-channel" class="select-field">
                <option value="game">Game</option>
                <option value="party">Party</option>
            </select>
            <input type="text" id="chat-input" class="input-field" placeholder="Type..." autocomplete="off">
            <button type="submit" class="btn btn-sm btn-primary">Send</button>
        </form>
    </div>

    <!-- Narrative Input Modal -->
    <div id="narrative-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 class="panel-header">Describe Your Action</h2>
            <p id="narrative-prompt">How do you use [Card Name]?</p>
            <textarea id="narrative-input" class="input-field" rows="3" placeholder="e.g., I chant the arcane words and a bolt of fire erupts from my hands..."></textarea>
            <div class="modal-actions">
                <button id="narrative-cancel-btn" class="btn btn-secondary">Cancel</button>
                <button id="narrative-confirm-btn" class="btn btn-primary">Confirm</button>
            </div>
        </div>
    </div>
    
    <!-- AP Modal -->
    <div id="ap-modal" class="modal-overlay hidden">
        <div class="modal-content ap-modal-content">
            <h2 class="panel-header">Out of Actions</h2>
            <p>You have used all your Action Points for this turn. Do you want to end your turn now?</p>
            <div class="modal-actions">
                <button id="ap-modal-cancel-btn" class="btn btn-secondary">Not Yet</button>
                <button id="ap-modal-confirm-btn" class="btn btn-primary">End Turn</button>
            </div>
        </div>
    </div>

    <!-- End Turn Confirmation Modal -->
    <div id="end-turn-confirm-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 class="panel-header">End Your Turn?</h2>
            <p>Are you sure you want to end your turn? You may not be able to take any more actions.</p>
            <div class="modal-actions">
                <button id="end-turn-cancel-btn" class="btn btn-secondary">Cancel</button>
                <button id="end-turn-confirm-btn" class="btn btn-danger">Confirm End Turn</button>
            </div>
        </div>
    </div>

    <!-- "Your Turn" Popup -->
    <div id="your-turn-popup" class="your-turn-popup hidden">YOUR TURN</div>

    <!-- Dice Roll Overlay -->
    <div id="dice-roll-overlay" class="modal-overlay hidden">
        <div class="dice-roll-content">
            <h2 id="dice-roll-title" class="panel-header">Attacking...</h2>
            <div class="dice-scene">
                <div id="attack-dice" class="dice">
                    <div class="face front"></div>
                    <div class="face back"></div>
                    <div class="face right"></div>
                    <div class="face left"></div>
                    <div class="face top"></div>
                    <div class="face bottom"></div>
                </div>
            </div>
            <div id="dice-roll-result" class="dice-roll-result-container hidden">
                <!-- Results will be populated here by JS -->
            </div>
        </div>
    </div>

    <!-- Event Overlay -->
    <div id="event-overlay" class="event-overlay hidden">
        <!-- Step 1: Roll Button -->
        <div id="event-roll-container" class="event-step-container">
            <h2 class="panel-header">An Event is Triggered!</h2>
            <p>Your actions have drawn the attention of fate. Roll the dice to see what happens.</p>
            <button id="roll-dice-btn" class="btn btn-special">Roll Dice</button>
        </div>

        <!-- Step 2: Dice Animation -->
        <div id="event-dice-animation-container" class="event-step-container hidden">
            <div class="dice-scene">
                <div id="dice" class="dice">
                    <div class="face front"></div>
                    <div class="face back"></div>
                    <div class="face right"></div>
                    <div class="face left"></div>
                    <div class="face top"></div>
                    <div class="face bottom"></div>
                </div>
            </div>
        </div>

        <!-- Step 3: Result and Card Choice -->
        <div id="event-result-container" class="event-step-container hidden">
            <h2 class="panel-header" id="event-result-title"></h2>
            <p id="event-result-subtitle"></p>
            <div id="event-card-selection" class="card-container-row hidden">
                <!-- Card backs will be generated here -->
            </div>
            <button id="event-result-okay-btn" class="btn btn-primary hidden">Okay</button>
        </div>
    </div>
    
    <!-- World Event Save Modal -->
    <div id="world-event-save-modal" class="modal-overlay hidden">
        <div class="modal-content" style="text-align: center;">
            <h2 id="world-event-save-title" class="panel-header">World Event!</h2>
            <p id="world-event-save-prompt">You must make a save!</p>
            <div class="dice-scene" style="margin: 1.5rem auto;">
                <div id="world-event-dice" class="dice">
                    <div class="face front"></div><div class="face back"></div><div class="face right"></div><div class="face left"></div><div class="face top"></div><div class="face bottom"></div>
                </div>
            </div>
            <p id="world-event-roll-result" class="hidden" style="font-weight: bold; font-size: 1.2rem; margin-bottom: 1rem;"></p>
            <button id="world-event-save-roll-btn" class="btn btn-special">Roll d20</button>
        </div>
    </div>


    <!-- Container for remote audio streams -->
    <div id="voice-chat-container"></div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="/client.js"></script>
</body>
</html>