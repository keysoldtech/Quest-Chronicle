<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest & Chronicle - Multiplayer Prototype</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=MedievalSharp&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet" href="/style.css">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Quest & Chronicle">
    <link rel="apple-touch-icon" href="/icon-192.png">
</head>
<body>

    <!-- Lobby Screen: Visible on page load -->
    <div id="lobby" class="lobby-container">
        <h1 class="title-font" data-text="Quest & Chronicle">Quest & Chronicle</h1>
        <p class="subtitle-font">Prototype 4.2.3</p>
        
        <div class="input-group">
            <label for="playerName">Player Name</label>
            <input type="text" id="playerName" class="input-field" placeholder="e.g., Elara the Brave">
        </div>
        
        <div id="game-mode-selector" class="input-group">
            <label>Game Mode</label>
            <div class="radio-group">
                <label class="radio-label">
                    <input type="radio" name="gameMode" value="Beginner" class="sr-only" checked>
                    <span>Beginner</span>
                </label>
                <label class="radio-label">
                    <input type="radio" name="gameMode" value="Advanced" class="sr-only">
                    <span>Advanced</span>
                </label>
            </div>
        </div>

        <div class="button-group">
            <button id="createRoomBtn" class="btn btn-primary">Create New Room</button>
            <div class="join-group">
                <input type="text" id="roomIdInput" class="input-field" placeholder="Enter Room Code">
                <button id="joinRoomBtn" class="btn btn-secondary">Join Room</button>
            </div>
        </div>
    </div>

    <!-- Game Area: Hidden until a room is joined -->
    <div id="game-area" class="game-area hidden">
        
        <!-- ================= DESKTOP LAYOUT ================= -->
        <div class="game-area-desktop">
            <header class="game-header">
                <div class="header-info">
                     <p id="turn-indicator" class="turn-indicator-font">Waiting for game to start...</p>
                     <p class="turn-counter">Turn: <span id="turn-counter">0</span></p>
                     <p class="build-number-font">v4.2.3</p>
                </div>
                 <div class="header-controls">
                    <div id="dm-controls" class="dm-controls hidden">
                         <button id="dm-play-monster-btn" class="btn btn-sm btn-secondary">Play Monster</button>
                    </div>
                    <button id="chat-toggle-btn" class="btn btn-sm btn-secondary">Chat & Log</button>
                    <button id="join-voice-btn" class="btn btn-sm btn-success">Join Voice</button>
                    <div id="header-action-buttons">
                        <button id="leave-game-btn" class="btn btn-sm btn-danger hidden">Leave Game</button>
                        <button id="startGameBtn" class="btn btn-primary hidden">Start Game</button>
                    </div>
                    <div class="room-code-display">
                        <p>Room Code:</p>
                        <p id="room-code">----</p>
                    </div>
                </div>
            </header>

            <aside class="players-panel panel">
                 <h2 class="panel-header">Players</h2>
                 <ul id="player-list" class="player-list"></ul>
            </aside>
            
            <aside class="character-panel panel">
                <!-- This panel contains multiple states -->
                <div id="class-selection" class="panel-content">
                    <h2 class="panel-header">Choose Your Class</h2>
                    <div id="class-cards-container" class="class-cards-container"></div>
                    <div class="class-confirm-container">
                         <button id="confirm-class-btn" class="btn btn-primary hidden">Confirm Class</button>
                    </div>
                </div>
                <div id="advanced-card-choice" class="panel-content hidden">
                    <h2 class="panel-header">Choose Starting Card</h2>
                    <div id="advanced-choice-buttons" class="button-grid"></div>
                </div>
                <div id="player-stats-container" class="panel-content hidden">
                     <h2 id="player-class-name" class="panel-header player-class-header hidden">Your Class</h2>
                     <div id="player-stats" class="player-stats"></div>
                </div>
            </aside>

            <main class="board-panel panel">
                <h2 class="panel-header">Game Board</h2>
                <div id="board-cards" class="card-container-row"></div>
            </main>

            <aside class="info-tabs-panel">
                <div class="tab-buttons">
                    <button class="tab-btn active" data-tab="world-events-tab">World Events</button>
                    <button class="tab-btn" data-tab="party-loot-tab">Party Discoveries</button>
                    <button class="tab-btn" data-tab="game-log-tab">Game Log</button>
                </div>
                <div id="world-events-tab" class="tab-content active">
                    <div id="world-events-container" class="card-container-row"></div>
                </div>
                <div id="party-loot-tab" class="tab-content">
                    <div id="party-loot-container" class="card-container-row"></div>
                </div>
                 <div id="game-log-tab" class="tab-content">
                    <div id="game-log-content" class="log-content-area"></div>
                </div>
            </aside>

            <footer class="hand-panel panel">
                 <div class="player-hand-header">
                    <h2 class="panel-header">Your Hand & Equipment</h2>
                 </div>
                <div class="hand-and-equipped-container">
                    <div id="equipped-items-container" class="equipped-items-container">
                        <h3 class="sub-header-font">Equipped</h3>
                        <div id="equipped-items" class="card-container-row"></div>
                    </div>
                    <div id="player-hand" class="player-hand-container card-container-row"></div>
                </div>
            </footer>

            <div id="fixed-action-bar" class="fixed-action-bar hidden">
                <button id="action-attack-btn" class="btn btn-danger hidden">Confirm Attack</button>
                <button id="action-guard-btn" class="btn btn-secondary">Guard (1 AP)</button>
                <button id="action-brief-respite-btn" class="btn btn-secondary">Brief Respite (1 AP)</button>
                <button id="action-full-rest-btn" class="btn btn-secondary">Full Rest (2 AP)</button>
                <button id="action-end-turn-btn" class="btn btn-primary">End Turn</button>
            </div>
        </div>

        <!-- ================= MOBILE LAYOUT ================= -->
        <div class="game-area-mobile">
            <header class="mobile-header">
                <div class="mobile-header-info">
                     <p id="mobile-turn-indicator" class="turn-indicator-font">Waiting...</p>
                     <p class="turn-counter">Turn: <span id="mobile-turn-counter">0</span></p>
                </div>
                 <div class="mobile-header-controls">
                    <div id="mobile-header-action-buttons">
                        <button id="mobile-leave-game-btn" class="btn btn-sm btn-icon btn-danger hidden"><span class="material-symbols-outlined">logout</span></button>
                        <button id="mobile-startGameBtn" class="btn btn-primary hidden">Start</button>
                    </div>
                </div>
            </header>
            
            <main class="mobile-main">
                <!-- Mobile Screen 1: Game (Board, Equipment, Hand, Actions) -->
                <div id="mobile-screen-game" class="mobile-screen active">
                    <div class="panel mobile-panel">
                        <h2 class="panel-header">Game Board</h2>
                        <div id="mobile-board-cards" class="card-container-row"></div>
                    </div>
                    <div id="mobile-player-equipment" class="panel mobile-panel">
                         <h2 class="panel-header">Your Equipment</h2>
                         <div id="mobile-equipped-items" class="card-container-row"></div>
                    </div>
                    <div class="panel mobile-panel">
                        <div class="player-hand-header">
                             <h2 class="panel-header">Your Hand</h2>
                        </div>
                        <div id="mobile-player-hand" class="card-container-row"></div>
                    </div>
                </div>

                <!-- Mobile Screen 2: Character (Stats, Class Selection) -->
                <div id="mobile-screen-character" class="mobile-screen">
                    <div id="mobile-class-selection" class="panel-content panel">
                        <h2 class="panel-header">Choose Your Class</h2>
                        <div id="mobile-class-cards-container" class="class-cards-container"></div>
                        <div class="class-confirm-container">
                             <button id="mobile-confirm-class-btn" class="btn btn-primary hidden">Confirm Class</button>
                        </div>
                    </div>
                    <div id="mobile-player-stats" class="panel mobile-panel">
                         <h2 id="mobile-player-class-name" class="panel-header player-class-header hidden">Your Class</h2>
                         <div id="mobile-stats-display" class="player-stats"></div>
                    </div>
                </div>

                <!-- Mobile Screen 3: Party (Player List) -->
                <div id="mobile-screen-party" class="mobile-screen">
                     <div class="panel mobile-panel">
                        <h2 class="panel-header">Players</h2>
                        <ul id="mobile-player-list" class="player-list"></ul>
                    </div>
                </div>
                
                <!-- Mobile Screen 4: Info (World Events, Discoveries) -->
                 <div id="mobile-screen-info" class="mobile-screen">
                     <div class="panel mobile-panel">
                         <h2 class="panel-header">World Events</h2>
                         <div id="mobile-world-events-container" class="card-container-row"></div>
                    </div>
                     <div class="panel mobile-panel">
                        <h2 class="panel-header">Party Discoveries</h2>
                        <div id="mobile-party-loot-container" class="card-container-row"></div>
                    </div>
                </div>

                <!-- Mobile Screen 5: Log -->
                <div id="mobile-screen-log" class="mobile-screen">
                    <div class="panel mobile-panel" style="flex: 1; display: flex; flex-direction: column;">
                        <div class="chat-header" style="margin-bottom: 0.5rem;">
                            <h2 class="panel-header" style="margin: 0; border: none;">Chat & Log</h2>
                        </div>
                        <div id="mobile-chat-log" class="chat-log" style="flex-grow: 1;"></div>
                        <form id="mobile-chat-form" class="chat-form" style="padding-top: 0.5rem; border-top: 1px solid var(--color-border)">
                            <select id="mobile-chat-channel" class="select-field">
                                <option value="game">Game</option>
                                <option value="party">Party</option>
                            </select>
                            <input type="text" id="mobile-chat-input" class="input-field" placeholder="Type..." autocomplete="off">
                            <button type="submit" class="btn btn-sm btn-primary">Send</button>
                        </form>
                    </div>
                </div>
            </main>

            <div id="mobile-action-bar" class="mobile-action-bar hidden">
                <button id="mobile-action-attack-btn" class="btn btn-danger btn-sm hidden">Attack</button>
                <button id="mobile-action-guard-btn" class="btn btn-secondary btn-sm">Guard</button>
                <button id="mobile-action-brief-respite-btn" class="btn btn-secondary btn-sm">Respite</button>
                <button id="mobile-action-full-rest-btn" class="btn btn-secondary btn-sm">Rest</button>
                <button id="mobile-action-end-turn-btn" class="btn btn-primary btn-sm">End Turn</button>
            </div>
            
            <nav class="mobile-bottom-nav">
                <button class="nav-btn active" data-screen="game"><span class="material-symbols-outlined">swords</span>Game</button>
                <button class="nav-btn" data-screen="character"><span class="material-symbols-outlined">person</span>Character</button>
                <button class="nav-btn" data-screen="party"><span class="material-symbols-outlined">groups</span>Party</button>
                <button class="nav-btn" data-screen="info"><span class="material-symbols-outlined">public</span>Info</button>
                <button class="nav-btn" data-screen="log"><span class="material-symbols-outlined">chat</span>Log</button>
            </nav>
        </div>

    </div>
    
    <!-- Shared Overlays/Modals -->
    <div id="chat-overlay" class="chat-overlay hidden">
        <div class="chat-header">
            <h2 class="panel-header">Chat & Log</h2>
            <button id="chat-close-btn" class="chat-close-btn">&times;</button>
        </div>
        <div id="chat-log" class="chat-log"></div>
        <form id="chat-form" class="chat-form">
            <select id="chat-channel" class="select-field">
                <option value="game">Game</option>
                <option value="party">Party</option>
            </select>
            <input type="text" id="chat-input" class="input-field" placeholder="Type..." autocomplete="off">
            <button type="submit" class="btn btn-sm btn-primary">Send</button>
        </form>
    </div>

    <div id="narrative-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 class="panel-header">Describe Your Action</h2>
            <p id="narrative-prompt">How do you use [Card Name]?</p>
            <textarea id="narrative-input" class="input-field" rows="3" placeholder="e.g., I chant the arcane words..."></textarea>
            <div class="modal-actions">
                <button id="narrative-cancel-btn" class="btn btn-secondary">Cancel</button>
                <button id="narrative-confirm-btn" class="btn btn-primary">Confirm</button>
            </div>
        </div>
    </div>

    <div id="ap-modal" class="modal-overlay hidden">
        <div class="modal-content ap-modal-content">
            <h2 class="panel-header">Out of Actions</h2>
            <p>You have used all your Action Points for this turn. Do you want to end your turn now?</p>
            <div class="modal-actions">
                <button id="ap-modal-cancel-btn" class="btn btn-secondary">Not Yet</button>
                <button id="ap-modal-confirm-btn" class="btn btn-primary">End Turn</button>
            </div>
        </div>
    </div>

    <div id="end-turn-confirm-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 class="panel-header">End Your Turn?</h2>
            <p>Are you sure you want to end your turn?</p>
            <div class="modal-actions">
                <button id="end-turn-cancel-btn" class="btn btn-secondary">Cancel</button>
                <button id="end-turn-confirm-btn" class="btn btn-danger">Confirm</button>
            </div>
        </div>
    </div>

    <div id="your-turn-popup" class="your-turn-popup hidden">YOUR TURN</div>
    
    <div id="roll-result-popup" class="roll-result-popup"></div>

    <div id="dice-roll-overlay" class="modal-overlay hidden">
        <div class="dice-roll-content">
            <h2 id="dice-roll-title" class="panel-header">Attacking...</h2>
            <div class="dice-scene">
                <div id="attack-dice" class="dice">
                    <div class="face front"></div><div class="face back"></div><div class="face right"></div><div class="face left"></div><div class="face top"></div><div class="face bottom"></div>
                </div>
            </div>
            <div id="dice-roll-result" class="dice-roll-result-container hidden"></div>
        </div>
    </div>

    <div id="event-overlay" class="event-overlay hidden">
        <div id="event-roll-container" class="event-step-container">
            <h2 class="panel-header">An Event is Triggered!</h2>
            <p>Roll the dice to see what happens.</p>
            <button id="roll-dice-btn" class="btn btn-special">Roll Dice</button>
        </div>
        <div id="event-dice-animation-container" class="event-step-container hidden">
            <div class="dice-scene"><div id="dice" class="dice"><div class="face front"></div><div class="face back"></div><div class="face right"></div><div class="face left"></div><div class="face top"></div><div class="face bottom"></div></div></div>
        </div>
        <div id="event-result-container" class="event-step-container hidden">
            <h2 class="panel-header" id="event-result-title"></h2>
            <p id="event-result-subtitle"></p>
            <div id="event-card-selection" class="card-container-row hidden"></div>
            <button id="event-result-okay-btn" class="btn btn-primary hidden">Okay</button>
        </div>
    </div>
    
    <div id="world-event-save-modal" class="modal-overlay hidden">
        <div class="modal-content" style="text-align: center;">
            <h2 id="world-event-save-title" class="panel-header">World Event!</h2>
            <p id="world-event-save-prompt">You must make a save!</p>
            <div class="dice-scene" style="margin: 1.5rem auto;">
                <div id="world-event-dice" class="dice"><div class="face front"></div><div class="face back"></div><div class="face right"></div><div class="face left"></div><div class="face top"></div><div class="face bottom"></div></div>
            </div>
            <p id="world-event-roll-result" class="hidden" style="font-weight: bold; font-size: 1.2rem; margin-bottom: 1rem;"></p>
            <button id="world-event-save-roll-btn" class="btn btn-special">Roll d20</button>
            <button id="world-event-save-continue-btn" class="btn btn-primary hidden">Continue</button>
        </div>
    </div>

    <div id="voice-chat-container"></div>
    
    <button id="skip-popup-btn" class="btn btn-secondary btn-sm skip-popup-btn hidden">Skip</button>

    <script src="/socket.io/socket.io.js"></script>
    <script src="/client.js"></script>
</body>
</html>